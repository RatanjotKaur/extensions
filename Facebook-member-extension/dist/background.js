let h=0;const m=1e3;async function d(o,i){const e=Date.now()-h;e<m&&await new Promise(r=>setTimeout(r,m-e)),h=Date.now();const c=await new Promise((r,u)=>{try{chrome.identity.getAuthToken({interactive:!0},a=>{if(chrome.runtime.lastError)return u(chrome.runtime.lastError);r(a||"")})}catch(a){u(a)}}),n=`https://sheets.googleapis.com/v4/spreadsheets/${encodeURIComponent(o)}/values/Sheet1!A:D:append?valueInputOption=RAW`,t=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({values:i})});if(!t.ok){const r=await t.text();throw new Error(`Sheets API error: ${t.status} ${r}`)}return t.json()}chrome.runtime.onMessage.addListener((o,i,s)=>{if(o.type==="SAVE_MEMBER")return(async()=>{try{const e=o.payload||{},n=(await new Promise(t=>chrome.storage.sync.get(["spreadsheetId"],t))).spreadsheetId||"YOUR_SHEET_ID";await d(n,[[e.name||"",e.profileUrl||"",e.requestDate||new Date().toISOString(),e.action||""]]),s({success:!0})}catch(e){console.error("Failed to save member:",e),s({success:!1,error:(e==null?void 0:e.message)||String(e)})}})(),!0});
